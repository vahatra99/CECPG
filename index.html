<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Les conseils cinéma de Madame Michu</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="icon" type="image/png" href="flaticon-633600.png">
    <style>
        body {
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            margin: 50px;
        }

        .liste {
            padding: 0px;
        }

        .liste li {
            position: relative;
            display: block;
            margin-bottom: 20px;
        }

        .liste li img {
            margin-right: 20px;
            width: 150px;
        }

        .liste div {
            position: absolute;
            top: 0px;
            left: 170px;
        }

        footer h1 {
            font-size: 1.2rem;
        }
    </style>
</head>

<body>
    <h1>Les conseils cinéma de Madame Michu</h1>

    <p>Voici mes coups de c&oelig;ur au cinéma pour l'année 2021, connaissez-vous leurs réalisateurs ou réalisatrices&nbsp;?</p>
    <ul class="liste">
    </ul>

    <footer>
        <h1>Mentions légales</h1>
        <p>
            Site édité par Philippe Gambette (philippe.gambette@univ-eiffel.fr)
        </p>
        <p>
            &copy; Philippe Gambette, 2021.
        </p>
        <p>
            Le code de cette page est un logiciel libre mis à disposition sous 
            <a href="https://www.gnu.org/licenses/gpl-3.0.html">licence GPLv3</a>. Vous pouvez le redistribuer ou le
            modifier suivant les termes de la GNU General Public License telle que publiée par la Free Software
            Foundation&nbsp;; soit la version 3 de la licence, soit (à votre gré) toute version ultérieure.
            Ce programme est distribué dans l'espoir qu'il sera utile, mais <strong>sans aucune garantie</strong>&nbsp;; sans même la garantie
            tacite de <strong>qualité marchande</strong> ou d'<strong>adéquation</strong> à <strong>un but particulier</strong>. Consultez la GNU General Public License
            pour plus de détails.
            Vous devez avoir reçu une copie de la GNU General Public License en même temps que ce programme&nbsp;; si ce
            n'est pas le cas, consultez <a href="http://www.gnu.org/licenses">http://www.gnu.org/licenses</a>.
        </p>
        <p>
            Les affiches de film utilisées sur ce site sont fournies en application de l'exception pédaogique prévue au
            3.e de l'<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000037388886/">article L122-5 du
                Code de la propriété intellectuelle</a>, en respectant les dispositions prévues dans les Bulletins
            officiels <a href="https://www.education.gouv.fr/bo/16/Hebdo35/MENE1600684X.htm?cid_bo=106736">n°35 du 29
                septembre 2016</a> et <a href="https://www.education.gouv.fr/bo/20/Hebdo6/MENE2000032X.htm">n°7 du 13
                février 2020</a>.
        </p>
        <p>
        <div><a href="https://www.flaticon.com/fr/icone-gratuite/clap_633600">Icône du site</a> conçue par <a
                href="https://www.flaticon.com/fr/auteurs/pixel-perfect" title="Pixel perfect">Pixel perfect</a> pour <a
                href="https://www.flaticon.com/fr/" title="Flaticon">www.flaticon.com</a></div>
        </p>
    </footer>

</body>
<script type="text/javascript">
    // Utilisation du mode strict de Javascript pour mieux repérer les erreurs
    "use strict";

    // Adaptation du titre de la page :
    document.querySelector('title').innerHTML = document.querySelector('title').innerHTML.replace('Madame Michu', 'Vahatriniaina');
    document.querySelector('h1').innerHTML = document.querySelector('title').innerHTML;
    console.log('Titre de la page modifié')

    // Données sur les films à charger :
    var dataFilms = [
        { 
            "titre": "Nomadland",
            "realisation": "Chloé Zhao",
            "casting": ["Frances McDormand", "David Strathairn", "Gay DeForest"],
            "sortie": "2021-06-09",
            "allocine": "271687",
            "wikidata": "Q61740820"
        }, 
        { 
            "titre": "Indes Galantes",
            "realisation": "Philippe Béziat",
            "casting": ["Clément Cogitore", "Bintou Dembélé"],
            "sortie": "2021-06-23",
            "allocine": "280843",
            "wikidata": "Q106713358"
        }, 
        { 
            "titre": "Kuessipan",
            "realisation": "Myriam Verreault",
            "casting": ["Sharon Fontaine-Ishpatao", "Yamie Grégoire", "Étienne Galloy"],
            "sortie": "2021-07-07",
            "allocine": "279799",
            "wikidata": "Q72710320" 
        }, 
        { 
            "titre": "La Nuit des rois",
            "realisation": "Philippe Lacôte",
            "casting": ["Bakary Koné", "Steve Tientcheu", "Digbeu Jean Cyrille", "Laetitia Ky"],
            "sortie": "2021-09-08",
            "allocine": "285624",
            "wikidata": "Q97959431" 
        }
    ];

    // Créer un bloc pour chaque film contenu dans data
    function ajouteFilms(data) {
        // Compteur du nombre de films affichés
        var nbFilms = 0;
        dataFilms.forEach(function (f) {
            // Mise à jour du compteur
            nbFilms = nbFilms + 1;
            // Ajout d'un film
            console.log('Film numéro ' + nbFilms + ' : ');
            console.log(f);
            // Création du bloc correspondant au film
            var blocFilm = document.createElement("li");
            // Ajout dans le bloc des informations sur le film (affiche, titre, date de sortie, lien Wikidata)
            blocFilm.innerHTML = '<img src="' + f.allocine + '.jpg">'
                + '<div>'
                + '<h2>'
                + '<a href="https://www.allocine.fr/film/fichefilm_gen_cfilm=' + f.allocine + '.html">'
                + f.titre
                + '</a></h2>'
                + '<p>Date de sortie : ' + formateDate(f.sortie) + '</p>'
                + '<p>Casting : ' + formateTableau(f.casting) + '</p>'
                + '<p>Savez-vous qui a réalisé ce film ?<br><input type="text" class="realisation" id="film' + nbFilms + '"></p>'
                + '</div>';
            // Ajout du film à la liste
            document.querySelector("ul").append(blocFilm)
        });
    }

    // Tests sur les noms entrés dans les champs réalisation
    function testRealisation(){
        // Sélection tous les champs réalisation
        document.querySelectorAll(".realisation").forEach(function(input){
            // Ajout d'un détecteur de pression d'une touche du clavier sur le champ réalisation sélectionné
            input.addEventListener("keyup", e => {
                // Récupération de l'identifiant du champ réalisation
                var idChamp = e.target.getAttribute("id");
                // Récupération du numéro du film correspondant
                var numeroFilm = parseInt(idChamp.replace("film",""))-1;
                console.log("Le champ réalisation du film " + numeroFilm + " a été modifié.")
                if(e.target.value.length>0){
                    console.log("La " + e.target.value.length + "e lettre du nom est " + dataFilms[numeroFilm].realisation[e.target.value.length-1]);
                }
                // Vérification que le nom entré dans le champ réalisation correspond au début du nom attendu
                if(e.target.value == debut(dataFilms[numeroFilm].realisation, e.target.value.length)){
                    // Coloration de l'arrière plan du champ en vert
                    e.target.style.backgroundColor = '#CCFFCC';
                } else {
                    // Coloration de l'arrière plan du champ en rouge
                    e.target.style.backgroundColor = '#FFCCCC';
                }
            })
        })
    }

    // Extraction des n premiers caractères au début d'un texte
    function debut(texte, nbCaracteres){
        return texte.substring(0, nbCaracteres);
    }

    // Formatage de la date
    function formateDate(date){
        // Extraction des composants de la date à l'aide d'une expression régulière
        // cf https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/RegExp
        var extraction = /([0-9]+)[-]([0-9]+)[-]([0-9]+)/.exec(date);
        // Récupération du jour, du mois et de l'année, transformés en nombres entiers
        //console.log(extraction)
        var annee = parseInt(extraction[1]);
        var mois = parseInt(extraction[2]);
        var jour = parseInt(extraction[3]);
        var listeMois = ["", "janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"];
        return jour + " " + listeMois[mois] + " " + annee;
    }

    // Formatage d'un tableau en séparant son contenu par des virgules
    // et en ajoutant des points de suspension à la fin
    function formateTableau(tab){
        var numCase = 0;
        var resultat = "";
        while(numCase < tab.length){
            if(numCase > 0){
                resultat = resultat + ", ";
            }
            resultat = resultat + tab[numCase];
            numCase += 1;
        }
        return resultat + "&hellip;";
    }

    // Appel de la fonction ajouteFilms pour créer les blocs des films
    ajouteFilms(dataFilms);

    // Ajout du test sur le nom des réalisateurs et réalisatrices
    testRealisation();
</script>
<script>
    
</script>

</html>
